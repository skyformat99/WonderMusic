function GetMusic(){this.fmData=["3778678","19723756","10520166","71385702","2884035","180106","21845217","120001"],this.init(0)}GetMusic.prototype={init:function(t){this.bind(),this.getList(this.fmData[t])},bind:function(){var t,i=this,a=!0,n=!1,o=!1;this.player=document.querySelector("audio"),this.player.ontimeupdate=function(){i.timenow=i.secondsToTime(i.player.currentTime),$(".timenow").text(i.timenow);var t=$(".progressbar").outerWidth(),a=t*(i.player.currentTime/i.player.duration);$(".pointnow").css("left",a-8),$(".pasttime").css("width",a);for(var n=0;n<i.lyric.length;n++){var o=$(".lyriclist li").eq(n).attr("dataTime");i.player.currentTime>=o&&($(".lyriclist li").removeClass("active"),$(".lyriclist li").eq(n).addClass("active"),$(".lyriclist").css({top:-30*(n-3),transition:"1s"}))}},this.player.oncanplay=function(){i.totaltime=i.secondsToTime(i.player.duration),$(".timetotal").text(i.totaltime)},this.player.onended=function(){i.playSong(i.idx+1)},$(".play").on("click",function(){i.player.paused?(i.player.play(),$(".play").html('<i class="fa fa-pause-circle fa-4x">')):(i.player.pause(),$(".play").html('<i class="fa fa-play-circle fa-4x">'))}),$(".backward").on("click",function(){0!==i.idx&&(n?i.playSong(i.randomArray[i.idx-1]):i.playSong(i.idx-1))}),$(".forward").on("click",function(){n?i.playSong(i.randomArray[i.idx+1]):i.playSong(i.idx+1)}),$(".volume").on("click",function(){0===i.player.volume?(i.player.volume=1,$(".volume").html('<i class="fa fa-volume-up"></i>')):(i.player.volume=0,$(".volume").html('<i class="fa fa-volume-off"></i>'))}),$(".list").on("click",function(){a?($("#playlist").hide(),a=!1):($("#playlist").show(),a=!0)}),$(".oneloop").on("click",function(){i.player.loop?(i.player.loop=!1,$(".ctrlbtnlist li").eq(0).removeClass("active")):(i.player.loop=!0,$(".ctrlbtnlist li").eq(0).addClass("active"))}),$(".random").on("click",function(){if(n)$(".ctrlbtnlist li").eq(4).removeClass("active"),n=!1,i.player.onended=function(){i.playSong(i.idx+1)};else{$(".ctrlbtnlist li").eq(4).addClass("active");var t=i.songArray.length;i.randomArray=[];for(var a=0;a<t;a++)i.randomArray[a]=a;i.randomArray.sort(function(){return.5-Math.random()}),i.player.onended=function(){i.playSong(i.randomArray[i.idx+1])},n=!0}}),$(".progressbar").on("click",function(t){var a=t.clientX-$(this).offset().left;i.moveTo(a)}),$(".songlist").on("click",".songitem",function(){i.playSong($(this).index())}),$(".search").on("keyup",function(t){13==t.keyCode&&i.searchSong()}),$(".fa-th-large").on("click",function(){o?($(".chanellist").css("display","none"),o=!1):($(".chanellist").css("display","block"),o=!0)}),$(".chanellist li").on("click",function(){i.getList(i.fmData[$(this).index()]),$(".songlist").scrollTop(0)}),$(".songlist").on("scroll",function(){t&&clearTimeout(t),t=setTimeout(function(){i.checkShow()},300)})},getList:function(t){var i=this;$.ajax({url:"http://www.joycesong.com/api/getPlaylist.php",method:"get",dataType:"json",data:{playlistid:t}}).done(function(t){var a=t.playlist;i.renderList(a.tracks),i.playSong(0)})},getUrl:function(t){var i=this;$.ajax({url:"http://www.joycesong.com/api/getSongUrl.php",method:"get",dataType:"json",data:{songid:i.idArray[t]}}).done(function(t){$("audio").attr("src",t.data[0].url)})},getLyric:function(t){var i=this;$.ajax({url:"http://www.joycesong.com/api/getLyric.php",method:"get",dataType:"json",data:{songid:i.idArray[t]}}).done(function(t){t.nolyric?$(".lyriclist").text("该歌曲无歌词"):($(".lyriclist").text(""),i.renderLyric(t.lrc.lyric))})},searchSong:function(){var t=this;$.ajax({url:"http://www.joycesong.com/api/searchSong.php",method:"get",dataType:"json",data:{songkey:$("#sq").val()}}).done(function(i){t.renderList(i.result.songs)})},playSong:function(t){this.resetTime(),this.getUrl(t),this.getLyric(t),this.setImg(t),this.setInfo(t),this.idx=t,$(".songlist li").removeClass("active"),$(".songlist li").eq(t).addClass("active")},setInfo:function(t){var i=this.songArray[t],a=this.singerArray[t];this.albumArray[t];$(".s-name").text(i),$(".s-singer").text(a)},setImg:function(t){var i=this.coverArray[t];$(".player-cover").css({"background-image":'url("'+i+'")'})},renderList:function(t){var i=t,a="";this.songArray=[],this.idArray=[],this.singerArray=[],this.albumArray=[],this.coverArray=[];for(var n=0;n<i.length;n++)this.songArray.push(i[n].name),this.idArray.push(i[n].id),this.singerArray.push(i[n].ar[0].name),this.albumArray.push(i[n].name),this.coverArray.push(i[n].al.picUrl),a+='<li class="songitem">',a+='<img class="lazy" src="img/blank.png" data-original="'+i[n].al.picUrl+'">',a+='<div class="intro-ct"><p class="i-name">'+i[n].name+"</p>",a+='<p class="i-info">'+i[n].ar[0].name+"-"+i[n].al.name+"</p></div>",a+='<span class="s-timetotal">'+this.msToTime(i[n].dt)+"</span></li>";$(".songlist").html(a),this.checkShow()},secondsToTime:function(t){return MM=Math.floor(t/60),SS=Math.floor(t%60),SS<10&&(SS="0"+SS),MM+":"+SS},msToTime:function(t){return seconds=t/1e3,MM=Math.floor(seconds/60),SS=Math.floor(seconds%60),SS<10&&(SS="0"+SS),MM+":"+SS},moveTo:function(t){var i=t/$(".progressbar").width()*this.player.duration;$(".pointnow").css("left",t),this.player.currentTime=i},formatLyric:function(t){var i=this,a=t.split("\n"),n=/^\[\d{2}\:\d{2}\.\d*\]/;return this.lyricArr=[],a.forEach(function(t){if(!n.test(t))return void a.splice(t,1);var o=t.match(n),r=t.split(o),e=600*o[0][1]+60*o[0][2]+10*o[0][4]+1*o[0][5];i.lyricArr.push([e,r[1]])}),this.lyricArr},renderLyric:function(t){this.lyric=this.formatLyric(t);var i="";this.lyric.forEach(function(t){i+='<li dataTime ="'+t[0]+'">'+t[1]+"</li>"}),$(".lyriclist").append(i)},resetTime:function(){$(".timenow").text("0:00"),$(".pointnow").css("left",-8),$(".pasttime").css("width",0)},isShow:function(t){var i=t.offset().top,a=$(window).height(),n=$(".songlist").scrollTop();return i<a+n},checkShow:function(){var t=this;$("img.lazy").each(function(){var i=$(this);!i.data("loaded")&&t.isShow(i)&&t.imgShow(i)})},imgShow:function(t){t.attr("src",t.attr("data-original")),t.data("loaded",!0)}},new GetMusic;