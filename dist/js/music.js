function GetMusic(){this.init()}GetMusic.prototype={init:function(){this.bind(),this.getList()},bind:function(){var t=this,i=!1,r=!1;this.player=document.querySelector("audio"),this.player.ontimeupdate=function(){t.timenow=t.secondsToTime(t.player.currentTime),$(".timenow").text(t.timenow);var i=$(".progressbar").outerWidth(),r=i*(t.player.currentTime/t.player.duration);$(".pointnow").css("left",r),$(".pasttime").css("width",r+8);for(var a=0;a<t.lyric.length;a++){var n=$(".lyriclist li").eq(a).attr("dataTime");t.player.currentTime>=n&&($(".lyriclist li").removeClass("active"),$(".lyriclist li").eq(a).addClass("active"),$(".lyriclist").css({top:-25*(a-1),transition:"1s"}))}},this.player.oncanplay=function(){t.totaltime=t.secondsToTime(t.player.duration),$(".timetotal").text(t.totaltime)},this.player.onended=function(){t.playSong(t.idx+1)},$(".play").on("click",function(){t.player.paused?(t.player.play(),$(".play").html('<i class="fa fa-pause-circle fa-4x">')):(t.player.pause(),$(".play").html('<i class="fa fa-play-circle fa-4x">'))}),$(".backward").on("click",function(){0!==t.idx&&(r?t.playSong(t.randomArray[t.idx-1]):t.playSong(t.idx-1))}),$(".forward").on("click",function(){r?t.playSong(t.randomArray[t.idx+1]):t.playSong(t.idx+1)}),$(".volume").on("click",function(){0===t.player.volume?(t.player.volume=1,$(".volume").html('<i class="fa fa-volume-up"></i>')):(t.player.volume=0,$(".volume").html('<i class="fa fa-volume-off"></i>'))}),$(".list").on("click",function(){i?($("#playlist").hide(),i=!1):($("#playlist").show(),i=!0)}),$(".oneloop").on("click",function(){t.player.loop?(t.player.loop=!1,$(".ctrlbtnlist li").eq(0).removeClass("active")):(t.player.loop=!0,$(".ctrlbtnlist li").eq(0).addClass("active"))}),$(".random").on("click",function(){if(r)$(".ctrlbtnlist li").eq(4).removeClass("active"),r=!1,t.player.onended=function(){t.playSong(t.idx+1)};else{$(".ctrlbtnlist li").eq(4).addClass("active");var i=t.songArray.length;t.randomArray=[];for(var a=0;a<i;a++)t.randomArray[a]=a;t.randomArray.sort(function(){return.5-Math.random()}),t.player.onended=function(){t.playSong(t.randomArray[t.idx+1])},r=!0}}),$(".progressbar").on("click",function(i){var r=i.clientX-$(this).offset().left;t.moveTo(r)}),$(".songlist").on("click",".songitem",function(){t.playSong($(this).index())})},getList:function(){var t=this;$.ajax({url:"http://www.joycesong.com/api/getPlaylist.php",method:"get",dataType:"json",data:{playlistid:19723756}}).done(function(i){var r=i.playlist;t.renderList(r),t.playSong(0)})},getUrl:function(t){var i=this;$.ajax({url:"http://www.joycesong.com/api/getSongUrl.php",method:"get",dataType:"json",data:{songid:i.idArray[t]}}).done(function(t){$("audio").attr("src",t.data[0].url)})},getLyric:function(t){var i=this;$.ajax({url:"http://www.joycesong.com/api/getLyric.php",method:"get",dataType:"json",data:{songid:i.idArray[t]}}).done(function(t){t.nolyric?$(".lyriclist").text("该歌曲无歌词"):($(".lyriclist").text(""),i.renderLyric(t.lrc.lyric))})},playSong:function(t){this.getUrl(t),this.getLyric(t),this.setImg(t),this.setInfo(t),this.idx=t},setInfo:function(t){var i=this.songArray[t],r=this.singerArray[t];this.albumArray[t];$(".s-name").text(i),$(".s-singer").text(r)},setImg:function(t){var i=this.coverArray[t];$(".player-cover").css({"background-image":'url("'+i+'")'})},renderList:function(t){var i=t.tracks,r="";this.songArray=[],this.idArray=[],this.singerArray=[],this.albumArray=[],this.coverArray=[];for(var a=0;a<i.length;a++)this.songArray.push(i[a].name),this.idArray.push(i[a].id),this.singerArray.push(i[a].ar[0].name),this.albumArray.push(i[a].name),this.coverArray.push(i[a].al.picUrl),r+='<li class="songitem">',r+='<img src="'+i[a].al.picUrl+'">',r+='<div class="intro-ct"><p class="i-name">'+i[a].name+"</p>",r+='<p class="i-info">'+i[a].ar[0].name+"-"+i[a].al.name+"</p></div>",r+='<span class="s-timetotal">'+this.msToTime(i[a].dt)+"</span></li>";$(".songlist").html(r)},secondsToTime:function(t){return MM=Math.floor(t/60),SS=Math.floor(t%60),SS<10&&(SS="0"+SS),MM+":"+SS},msToTime:function(t){return seconds=t/1e3,MM=Math.floor(seconds/60),SS=Math.floor(seconds%60),SS<10&&(SS="0"+SS),MM+":"+SS},moveTo:function(t){var i=t/$(".progressbar").width()*this.player.duration;$(".pointnow").css("left",t),this.player.currentTime=i},formatLyric:function(t){var i=this,r=t.split("\n"),a=/^\[\d{2}\:\d{2}\.\d*\]/;return this.lyricArr=[],r.forEach(function(t){if(!a.test(t))return void r.splice(t,1);var n=t.match(a),e=t.split(n),o=600*n[0][1]+60*n[0][2]+10*n[0][4]+1*n[0][5];i.lyricArr.push([o,e[1]])}),this.lyricArr},renderLyric:function(t){this.lyric=this.formatLyric(t);var i="";this.lyric.forEach(function(t){i+='<li dataTime ="'+t[0]+'">'+t[1]+"</li>"}),$(".lyriclist").append(i)}},new GetMusic;