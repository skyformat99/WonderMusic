function GetMusic(){this.fmData=["3778678","19723756","10520166","71385702","2884035","180106","21845217","120001"],this.init(0)}GetMusic.prototype={init:function(t){this.bind(),this.getList(this.fmData[t])},bind:function(){var t,i=this,a=!1;this.player=document.querySelector("audio"),this.player.ontimeupdate=function(){i.timenow=i.secondsToTime(i.player.currentTime),$(".timenow").text(i.timenow);var t=$(".progressbar").outerWidth(),a=t*(i.player.currentTime/i.player.duration);$(".pointnow").css("left",a-8),$(".pasttime").css("width",a);for(var s=0;s<i.lyric.length;s++){var r=$(".lyriclist li").eq(s).attr("dataTime");i.player.currentTime>=r&&($(".lyriclist li").removeClass("active"),$(".lyriclist li").eq(s).addClass("active"),$(".lyriclist").css({top:-30*(s-3),transition:"1s"}))}},this.player.onended=function(){i.playSong(i.idx+1)},$(".play").on("click",function(){i.player.paused?i.startPlay():i.stopPlay()}),$(".backward").on("click",function(){0!==i.idx&&(a?i.playSong(i.randomArray[i.idx-1]):i.playSong(i.idx-1))}),$(".forward").on("click",function(){a?i.playSong(i.randomArray[i.idx+1]):i.playSong(i.idx+1)}),$(".volume").on("click",function(){0===i.player.volume?(i.player.volume=1,$(".volume").html('<i class="fa fa-volume-up"></i>')):(i.player.volume=0,$(".volume").html('<i class="fa fa-volume-off"></i>'))}),$(".list").on("click",function(){"hidden"==$("#playlist").css("visibility")?$("#playlist").css({visibility:"visible"}):$("#playlist").css({visibility:"hidden"})}),$(".backtoplayer").on("click",function(){$("#playlist").css({visibility:"hidden"})}),$(".oneloop").on("click",function(){i.player.loop?(i.player.loop=!1,$(".ctrlbtnlist li").eq(0).removeClass("active")):(i.player.loop=!0,$(".ctrlbtnlist li").eq(0).addClass("active"))}),$(".random").on("click",function(){if(a)$(".ctrlbtnlist li").eq(4).removeClass("active"),a=!1,i.player.onended=function(){i.playSong(i.idx+1)};else{$(".ctrlbtnlist li").eq(4).addClass("active");var t=i.songArray.length;i.randomArray=[];for(var s=0;s<t;s++)i.randomArray[s]=s;i.randomArray.sort(function(){return.5-Math.random()}),i.player.onended=function(){i.playSong(i.randomArray[i.idx+1])},a=!0}}),$(".progressbar").on("click",function(t){var a=t.clientX-$(this).offset().left;i.moveTo(a)}),$(".songlist").on("click",".songitem",function(){i.playSong($(this).index())}),$(".search").on("keyup",function(t){13==t.keyCode&&(i.searchSong(),$("#sq").val(""))}),$(".chanellist li").on("click",function(){i.getList(i.fmData[$(this).index()]),$(".songlist").scrollTop(0)}),$(".songlist").on("scroll",function(){t&&clearTimeout(t),t=setTimeout(function(){i.checkShow()},300)})},getList:function(t){var i=this;$.ajax({url:"http://www.joycesong.com/api/getPlaylist.php",method:"get",dataType:"json",data:{playlistid:t}}).done(function(t){var a=t.playlist;i.renderList(a.tracks),i.playSong(0)})},getUrl:function(t){var i=this;$.ajax({url:"http://www.joycesong.com/api/getSongUrl.php",method:"get",dataType:"json",data:{songid:i.idArray[t]}}).done(function(t){$("audio").attr("src",t.data[0].url),i.startPlay()})},getLyric:function(t){var i=this;$.ajax({url:"http://www.joycesong.com/api/getLyric.php",method:"get",dataType:"json",data:{songid:i.idArray[t]}}).done(function(t){t.nolyric||t.uncollected?$(".lyriclist").text("该歌曲无歌词"):($(".lyriclist").text(""),i.renderLyric(t.lrc.lyric))}).fail(function(){$(".lyriclist").text("该歌曲无歌词")})},searchSong:function(){var t=this;$.ajax({url:"http://www.joycesong.com/api/searchSong.php",method:"get",dataType:"json",data:{songkey:$("#sq").val()}}).done(function(i){t.renderList(i.result.songs),$(".songlist").scrollTop(0)})},playSong:function(t){this.resetTime(),this.getUrl(t),this.getLyric(t),this.setImg(t),this.setInfo(t),this.idx=t,$(".timetotal").text(this.totalTimeArray[t]),$(".songlist li").removeClass("active"),$(".songlist li").eq(t).addClass("active")},startPlay:function(){this.player.play(),this.player.paused||$(".play").html('<i class="fa fa-pause-circle fa-4x">')},stopPlay:function(){this.player.pause(),this.player.paused&&$(".play").html('<i class="fa fa-play-circle fa-4x">')},setInfo:function(t){var i=this.songArray[t],a=this.singerArray[t];this.albumArray[t];$(".s-name").text(i),$(".s-singer").text(a)},setImg:function(t){var i=this.coverArray[t];$(".player-cover").css({"background-image":'url("'+i+'")'})},renderList:function(t){var i=t,a="";this.songArray=[],this.idArray=[],this.singerArray=[],this.albumArray=[],this.coverArray=[],this.totalTimeArray=[];for(var s=0;s<i.length;s++)this.songArray.push(i[s].name),this.idArray.push(i[s].id),this.singerArray.push(i[s].ar[0].name),this.albumArray.push(i[s].name),this.coverArray.push(i[s].al.picUrl),this.totalTimeArray.push(this.msToTime(i[s].dt)),a+='<li class="songitem">',a+='<img class="lazy" src="img/blank.png" data-original="'+i[s].al.picUrl+'">',a+='<div class="intro-ct"><p class="i-name">'+i[s].name+"</p>",a+='<p class="i-info">'+i[s].ar[0].name+"-"+i[s].al.name+"</p></div>",a+='<span class="s-timetotal">'+this.msToTime(i[s].dt)+"</span></li>";$(".songlist").html(a),this.checkShow()},secondsToTime:function(t){return MM=Math.floor(t/60),SS=Math.floor(t%60),SS<10&&(SS="0"+SS),MM+":"+SS},msToTime:function(t){return seconds=t/1e3,MM=Math.floor(seconds/60),SS=Math.floor(seconds%60),SS<10&&(SS="0"+SS),MM+":"+SS},moveTo:function(t){var i=t/$(".progressbar").width()*this.player.duration;$(".pointnow").css("left",t),this.player.currentTime=i},formatLyric:function(t){var i=this,a=t.split("\n"),s=/^\[\d{2}\:\d{2}\.\d*\]/;return this.lyricArr=[],a.forEach(function(t){if(!s.test(t))return void a.splice(t,1);var r=t.match(s),n=t.split(r),o=600*r[0][1]+60*r[0][2]+10*r[0][4]+1*r[0][5];i.lyricArr.push([o,n[1]])}),this.lyricArr},renderLyric:function(t){this.lyric=this.formatLyric(t);var i="";this.lyric.forEach(function(t){i+='<li dataTime ="'+t[0]+'">'+t[1]+"</li>"}),$(".lyriclist").append(i)},resetTime:function(){$(".timenow").text("0:00"),$(".pointnow").css("left",-8),$(".pasttime").css("width",0)},isShow:function(t){var i=t.offset().top,a=$(window).height(),s=$(".songlist").scrollTop();return i<a+s},checkShow:function(){var t=this;$("img.lazy").each(function(){var i=$(this);!i.data("loaded")&&t.isShow(i)&&t.imgShow(i)})},imgShow:function(t){t.attr("src",t.attr("data-original")),t.data("loaded",!0)}},new GetMusic;