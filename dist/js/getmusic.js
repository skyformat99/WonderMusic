function TopSoaringMp(){this.init()}TopSoaringMp.prototype={init:function(){navigator.userAgent.match(/(iPhone|iPod|Android|ios|MSIE|Edge|Trident)/g)?(alert("抱歉，该您的浏览器不兼容本web应用的部分效果，请在chrome/safari/firefox浏览器内使用本应用。"),$("body").html("")):(this.bind(),this.getList())},bind:function(){var i=this,t=!1,r=!1;this.player=document.querySelector("audio"),this.player.ontimeupdate=function(){i.timenow=i.secondsToTime(i.player.currentTime),$(".timenow").text(i.timenow);var t=$(".progress-bar").width(),r=t*(i.player.currentTime/i.player.duration);$(".progress-now").css("left",r),$(".buffer-now").css("width",r+10);for(var a=0;a<i.lyric.length;a++){var n=$(".lyriclist li").eq(a).attr("dataTime");i.player.currentTime>=n&&($(".lyriclist li").removeClass("active"),$(".lyriclist li").eq(a).addClass("active"),$(".lyriclist").css({top:-25*(a-1),transition:"1s"}))}},this.player.oncanplay=function(){i.totaltime=i.secondsToTime(i.player.duration),$(".timetotal").text(i.totaltime)},this.player.onended=function(){i.playSong(i.idx+1)},$(".play").on("click",function(){i.player.paused?(i.player.play(),$(".play").html('<i class="fa fa-pause-circle">'),$(".disc").css({"animation-play-state":"running"}),$(".bgimg").css({"animation-play-state":"running"}),$(".needle").removeClass("pause")):(i.player.pause(),$(".play").html('<i class="fa fa-play-circle">'),$(".disc").css({"animation-play-state":"paused"}),$(".bgimg").css({"animation-play-state":"paused"}),$(".needle").addClass("pause"))}),$(".backward").on("click",function(){0!==i.idx&&(r?i.playSong(i.randomArray[i.idx-1]):i.playSong(i.idx-1))}),$(".forward").on("click",function(){r?i.playSong(i.randomArray[i.idx+1]):i.playSong(i.idx+1)}),$(".volume").on("click",function(){0===i.player.volume?(i.player.volume=1,$(".volume").html('<i class="fa fa-volume-up"></i>')):(i.player.volume=0,$(".volume").html('<i class="fa fa-volume-off"></i>'))}),$(".fa-list-ul").on("click",function(){t?($(".playlist").hide(),t=!1):($(".playlist").show(),t=!0)}),$(".oneloop").on("click",function(){i.player.loop?(i.player.loop=!1,$(".fa-retweet").css({color:"#fff"})):(i.player.loop=!0,$(".fa-retweet").css({color:"#B72712"}))}),$(".random").on("click",function(){if(r)$(".fa-random").css({color:"#fff"}),r=!1,i.player.onended=function(){i.playSong(i.idx+1)};else{$(".fa-random").css({color:"#B72712"});var t=i.songArray.length;i.randomArray=[];for(var a=0;a<t;a++)i.randomArray[a]=a;i.randomArray.sort(function(){return.5-Math.random()}),i.player.onended=function(){i.playSong(i.randomArray[i.idx+1])},r=!0}}),$(".progress-bar").on("click",function(t){var r=t.clientX-$(this).offset().left;i.moveTo(r)}),$(".playlist").on("click",".songitem",function(){i.playSong($(this).index())})},getList:function(){var i=this;$.ajax({url:"http://www.joycesong.com/api/getPlaylist.php",method:"get",dataType:"json",data:{playlistid:19723756}}).done(function(t){var r=t.playlist;i.renderList(r),i.playSong(0)})},getUrl:function(i){var t=this;$.ajax({url:"http://www.joycesong.com/api/getSongUrl.php",method:"get",dataType:"json",data:{songid:t.idArray[i]}}).done(function(i){$("audio").attr("src",i.data[0].url)})},getLyric:function(i){var t=this;$.ajax({url:"http://www.joycesong.com/api/getLyric.php",method:"get",dataType:"json",data:{songid:t.idArray[i]}}).done(function(i){i.nolyric?$(".lyriclist").text("该歌曲无歌词"):($(".lyriclist").text(""),t.renderLyric(i.lrc.lyric))})},playSong:function(i){this.getUrl(i),this.getLyric(i),this.setImg(i),this.setInfo(i),this.idx=i},setInfo:function(i){var t=this.songArray[i],r=this.singerArray[i],a=this.albumArray[i];$(".s-header").text(t),$(".s-album").text("专辑："+a),$(".s-singer").text("歌手："+r)},setImg:function(i){var t=this.coverArray[i];$("img").attr("src",t),$("body").css({"background-image":'url("'+t+'")'})},renderList:function(i){var t=i.tracks,r="";this.songArray=[],this.idArray=[],this.singerArray=[],this.albumArray=[],this.coverArray=[];for(var a=0;a<t.length;a++)this.songArray.push(t[a].name),this.idArray.push(t[a].id),this.singerArray.push(t[a].ar[0].name),this.albumArray.push(t[a].name),this.coverArray.push(t[a].al.picUrl),r+='<li class="songitem">'+t[a].name+"</li>";$(".playlist").html(r)},secondsToTime:function(i){return MM=Math.floor(i/60),SS=Math.floor(i%60),SS<10&&(SS="0"+SS),MM+":"+SS},moveTo:function(i){var t=i/$(".progress-bar").width()*this.player.duration;$(".progress-now").css("left",i),this.player.currentTime=t},formatLyric:function(i){var t=this,r=i.split("\n"),a=/^\[\d{2}\:\d{2}\.\d*\]/;return this.lyricArr=[],r.forEach(function(i){if(!a.test(i))return void r.splice(i,1);var n=i.match(a),o=i.split(n),e=600*n[0][1]+60*n[0][2]+10*n[0][4]+1*n[0][5];t.lyricArr.push([e,o[1]])}),this.lyricArr},renderLyric:function(i){this.lyric=this.formatLyric(i);var t="";this.lyric.forEach(function(i){t+='<li dataTime ="'+i[0]+'">'+i[1]+"</li>"}),$(".lyriclist").append(t)}},new TopSoaringMp;